<!DOCTYPE html>
<html>
<head>
	<title></title>
	<script>  
			window.onload = function() {
        document.body.style.backgroundImage = "url('data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wCEAAkGBw0NDQ0HBw0HBwcNBw0HBwcHBw8IDQcNFREWFhURExMYHSggGBolGxMVITEhJSkrLi4uFx8zODMsNygtLisBCgoKDQ0NDw8PDysZFRkrKzctLSsrLS0rNzcrKy03LTc3KzctNzc3LTc3LTctLS03LSsrLTctLS03LS0tLTctLf/AABEIALYBFQMBIgACEQEDEQH/xAAWAAEBAQAAAAAAAAAAAAAAAAAAAQb/xAAVEAEBAAAAAAAAAAAAAAAAAAAAAf/EABcBAQEBAQAAAAAAAAAAAAAAAAABBQT/xAAVEQEBAAAAAAAAAAAAAAAAAAAAAf/aAAwDAQACEQMRAD8A2ADuYwAAAAAAAAAgAKAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAoAAAAAAAAAAAAAIACgAAAAAAAAAAAAAAAgAKAAAAAAAAAAAAAAAAAAAAAAAAKICgAgAAAACggAAAAAAAAAgAKAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACoAAAAgAAAKAAAAAAAAAAAAAAAAAAAAAAAACoIKgKAKCAAAAAACoAAAAgAKAAAAAAAAgAKAAAAAAAIACgqAAACoAAAACAAoCoIAoAAAAAAAAAAAAAAAIAAAqKCoAAAAAACAAoAAqAAAAAAAAAAAAAAAACAAoAAACAqCgAgAKACAAAAAAAAAAoAAAAAAAAAAAAAAAIAAAAABAAAAQLQUoAgAAACgAoAAAAAgAKAAgAIAAAKj/9k=')";
    }
		function validateform(){  
           
                  var name=document.getElementById("name").value;
                  var username = document.getElementById("username").value;
                  var email=document.getElementById("email").value;
                  var phonenumber=document.getElementById("phnnumber").value;
                 var dob = document.getElementById("dob").value;
                  var binnumber=document.getElementById("binnumber").value;
                  var password=document.getElementById("password").value;  
		          var currpassword=document.getElementById("conpassword").value;
                  var address=document.getElementById("address").value;
                  var radios = document.getElementsByName("usertype");
                  var checked = false;
                  
		         for (var i = 0; i < radios.length; i++) 
				 {
                 if (radios[i].checked)
				    {
                    checked = true;
                    break;
                    }
                }
                  if (name.trim() == "") {
                  alert("Please enter a Name");
                  return false;
                  }
                  if (email==null || email==""){  
		            alert("Email can't be blank");  
		            return false;  
		          }
                  if (username.trim() == "") {
                  alert("Please enter a username");
                  return false;
                  }
               if (password == null || password == '') {
                 alert('password is empty');
                 return false;
                }
                if (currpassword == null || currpassword == '') {
                 alert('Confirm Password is empty');
                 return false;
                }
                if (phonenumber==null || phonenumber==""){  
		           alert("PhoneNumber can't be blank");  
		           return false;  
		          }
                 if (binnumber==null || binnumber==""){  
		           alert("Binnumber can't be blank");  
		           return false;  
		         }
                 if(name.trim() != "")
                 {
                  const regex = /^[a-zA-Z\s]*$/;
                  if(!regex.test(name.trim()))
                   {
                 alert("Invalid name");  
                 return false; 
                   }
                 }
                if (dob == null || dob == '') {
                 alert('Date is empty');
                 return false;
                }
                if(!checked)
                {
                    alert("Please Select a User Type.");  
		            return false;
                }
                if(address == null || address == '')
                {
                    alert("Address is empty");  
		            return false;
                }
              if(password.length<8)
		       {  
		        alert("Password must be at least 8 characters long.");  
		        return false;  
		       } 
             if(password.length>=8)
              {
                const pattern = /^(?=.*?[A-Z])(?=.*?[a-z])(?=.*?[0-9])(?=.*?[#?!@$%^&*-]){8,}\S+$/;
                if(!pattern.test(password))
                 {
                   alert("Weak and Invalid Password");  
                   return false; 
                 }
              }
          if(currpassword.length<8)
            {
               alert("Confirm Password and Password didn't match");  
               return false; 
            }
          if(currpassword.length>=8 && password.length>=8)
            {
            if(currpassword !=password)
            {
               alert("Confirm Password and Password didn't match");  
               return false; 
            }       
           }      
        if (dob != null || dob != '')
         {
           const dateFormat = /^(\d{4})-(\d{2})-(\d{2})$/;
           if (!dob.match(dateFormat)) {
           return false;
         }
  
       const year = parseInt(RegExp.$1);
       const month = parseInt(RegExp.$2);
       const day = parseInt(RegExp.$3);
       const dobDate = new Date(year, month - 1, day);
       const ageInMs = Date.now() - dobDate.getTime();
       const ageInYears = ageInMs / (1000 * 60 * 60 * 24 * 365.25);  
       if (ageInYears < 21 || ageInYears > 75) {
         alert("Invalid Age"); 
         return false;
        }
        }
	      if(email.length>0)
            {
                 
             const pattern= /^(([^<>()[\]\.,;:\s@\"]+(\.[^<>()[\]\.,;:\s@\"]+)*)|(\".+\"))@(([^<>()[\]\.,;:\s@\"]+\.)+[^<>()[\]\.,;:\s@\"]{2,})$/i;
             if(!pattern.test(email))
              {
                 alert("Invalid email address");  
                 return false;
              }
            }
            if(phonenumber.length===11)
           {
            
                  var phoneregex = /^(?:\+?88)?01[15-9]\d{8}$/;
			if (!phoneregex.test(phonenumber)) {
				alert("Please enter a valid phone number.");
				return false;
			}
               
            }
            if(username)
            {
               const regex = /^[a-zA-Z0-9_-]{5,16}$/;
               if(!regex.test(username.trim()))
               {
                 alert("Invalid username and Username must be between 5 to 16 characters");  
                 return false; 
               }
            }
            if(binnumber.length!=12)
           {          
               alert("BIN number Must be 12 digit");  
               return false; 
               
           } 
    
    if (username != "" && phonenumber != "" && email != "" && binnumber != "") {
        var res=helpvalidateform(username,email,phonenumber,binnumber);
        if(res==true)
        {
            //alert("true");
            return true;
        }
        else if(res==false)
        {
            //alert("false");
            return false;
        } 
    }
//            if (dob.value !== "") 
// {
//     alert("Here dob");
//     const dateFormat = /^\d{4}-\d{2}-\d{2}$/;
//     if (!dob.value.match(dateFormat)) {
//         return false;
//     }
//     const year = parseInt(RegExp.$1);
//     const month = parseInt(RegExp.$2);
//     const day = parseInt(RegExp.$3);
//     const dobDate = new Date(year, month - 1, day);
//     const ageInMs = Date.now() - dobDate.getTime();
//     const ageInYears = ageInMs / (1000 * 60 * 60 * 24 * 365.25);  
//     if (ageInYears < 21 || ageInYears > 75) {
//         alert("Invalid Age"); 
//         return false;
//     }
// }
           if(binnumber.length!=12)
           {          
               alert("BIN number Must be 12 digit");  
               return false; 
               
           } 


}
function helpvalidateform(username,email,phonenumber,binnumber)
{
    var xhttp = new XMLHttpRequest();
    var result = false;
               
    xhttp.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
            if (this.responseText == "exists") {
                alert("Username already exists. Please choose another one.");
            }
            else if(this.responseText == "email exists"){
                alert("Email already exists. Please choose another one."); 
            }
            else if(this.responseText == "Binnumber exists"){
                alert("BIN Number already exists. Please choose another one.");
            }
            else if(this.responseText == "phone exists"){
                alert("Phone Number already exists. Please choose another one."); 
            }
            else {
                result = true;
            }
        }
    };
    xhttp.open("POST", "../Controller/CheckDuplication.php", false);
    xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
    xhttp.send("username=" + username+"&email=" + email+"&phonenumber=" + phonenumber+"&binnumber=" + binnumber);
    return result;
}
function checkName() {
			if (document.getElementById("name").value == "") {
			  	document.getElementById("nameErr").innerHTML = "Name can't be blank";
			  	document.getElementById("name").style.borderColor = "red";
			}else{
			  	document.getElementById("nameErr").innerHTML = "";
			  	document.getElementById("name").style.borderColor = "black";

			}
			
        }

function checkEmail(){
           if (document.getElementById("email").value == "") {
              document.getElementById("EmailErr").innerHTML = "Email can't be blank";
              document.getElementById("email").style.borderColor = "red";
           }else{
              document.getElementById("EmailErr").innerHTML = "";
              document.getElementById("email").style.borderColor = "black";
           }
        }
	function checkUName(){
        if (document.getElementById("username").value == "") {
            document.getElementById("UsernErr").innerHTML = "Username can't be blank";
            document.getElementById("username").style.borderColor = "red";
        }else{
            document.getElementById("unameErr").innerHTML = "";
            document.getElementById("UsernErr").style.borderColor = "black";
        }
        } 
        function checkDob(){
        if (document.getElementById("dob").value == "") {
            document.getElementById("DobErr").innerHTML = "Date of Birth can't be blank";
            document.getElementById("dob").style.borderColor = "red";
        }else{
              document.getElementById("DobErr").innerHTML = "";
              document.getElementById("dob").style.borderColor = "black";
        }
        }
        function checkPhoneNumber(){
        if (document.getElementById("phnnumber").value == "") {
            document.getElementById("PhoneNumberErr").innerHTML = "Phone Number can't be blank";
            document.getElementById("phnnumber").style.borderColor = "red";
        }else{
            document.getElementById("PhoneNumberErr").innerHTML = "";
            document.getElementById("phnnumber").style.borderColor = "black";
        }
        }
        function checkBin(){
        if (document.getElementById("binnumber").value == "") {
            document.getElementById("BinErr").innerHTML = "Bin Number can't be blank";
            document.getElementById("binnumber").style.borderColor = "red";
        }else{
            document.getElementById("BinErr").innerHTML = "";
            document.getElementById("binnumber").style.borderColor = "black";
        }
        }
        function checkCpass(){
        if (document.getElementById("conpassword").value == "") {
            document.getElementById("CpassErr").innerHTML = "Password and Confirm Password can't be blank";
            document.getElementById("conpassword").style.borderColor = "red";
        }else{
            document.getElementById("CpassErr").innerHTML = "";
            document.getElementById("conpassword").style.borderColor = "black";
        }
        }
        function checkPass(){
           if (document.getElementById("password").value == "") {
		   document.getElementById("passErr").innerHTML = "Password can't be blank";
		   document.getElementById("password").style.borderColor = "red";
	     }else{
		   document.getElementById("passErr").innerHTML = "";
		   document.getElementById("password").style.borderColor = "black";
			}
        }    
	
</script>  
</head>
<title>Registration form</title> 
<link rel="stylesheet" href="../Style/TrnasportOwnerReg.css">
</head>
<body>
<br />
<div>  
	<fieldset >
	  <legend><b>Registration</legend>                
	  <center><form  method="post" action="../Controller/CreateRegisteredUser.php" onsubmit="return validateform()" > 
            Name: <input type="text" name="name" id="name" placeholder="Enter Name" onblur="checkName()" onkeyup="checkName()">
            <p id="nameErr"></p> 
            Email: <input type="text" id="email" name="email" placeholder="Enter Email" onblur="checkEmail()">
            <p id="EmailErr"></p> 
            UserName: <input type="text" id="username" name="username" placeholder="Enter UserName" onblur="checkUName()">
            <p id="UsernErr"></p>
            Password: <input type="password" id="password" name="password" placeholder="Enter Password" onblur="checkPass()">
            <p id="passErr"></p>
            Confirm Password: <input type="password" id="conpassword" name="conpassword" placeholder="Confirm Password" onblur="checkCpass()">
            <p id="CpassErr"></p>
            Phone Number: <input type="number" id="phnnumber" name="phnnumber" placeholder="Enter Phone Number" onblur="checkPhoneNumber()">
            <p id="PhoneNumberErr"></p> 
            Date of Birth: <input type="date" id="dob" name="dob" onblur="checkDob()">
            <p id="DobErr"></p>
            BIN Certificate Number: <input type="number" id="binnumber" name="binnumber" placeholder="BIN Number" onblur="checkBin()">
            <p id="BinErr"></p>
            <fieldset>
                <legend>User Type</legend>
                <label><input type="radio" id="transportowner" name="usertype" value="transportowner"> Transport Owner</label>
                <label><input type="radio" id="terminalowner" name="usertype" value="terminalowner"> Terminal Owner</label></br>
                <label><input type="radio" id="exporterimporter" name="usertype" value="exporterimporter"> Exporter/Importer</label>
          </fieldset>
          Address: <input type="text" id="address" name="address" placeholder="Enter Address" onblur="checkAddress()">
            <p id="AddressErr"></p>
<input type="submit" name="submit" value="Register"></br>
<a href="Login.html">Already Have an Account?</a>  
</form>  </center>
</body>
</html>